(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e;}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n);}}();var Plugin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._iframeInfo=null,e._target=null,e._setupId=null,e._userPositions=new Map,e}return __extends(e,t),e.prototype.onLoad=function(t,e){Logger.init(this);try{if(!e.isLocal)throw new Error("Portal does not support global mode");this._iframeInfo=e.iframe,t?this._target=t.target:this.saveData({target:null});}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype.onPlayerMove=function(t,e,r){try{if(null===this._iframeInfo)return;if(this._userPositions.set(t,[e,r]),this._iframeInfo.x<=e&&e<this._iframeInfo.x+this._iframeInfo.width&&this._iframeInfo.y<=r&&r<this._iframeInfo.y+this._iframeInfo.height){if(null===this._target)return;this.teleportPlayer(t,this._target[0],this._target[1]);}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype.onMessage=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];try{if("checkShouldSetup"===e){if(!this.isAdmin(t))return;null===this._target&&(this._setupId=Math.floor(65536*Math.random()).toString(16).padStart(4,"0"),this.sendMessage(t,"setup",this._setupId));}else if("setup"===e){if(!this.isAdmin(t))return;var o=r[0],i=r[1];if(!Number.isInteger(o)||!Number.isInteger(i))return;this._target=[o,i],this.saveData({target:[o,i]});}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype.onChat=function(t,e){try{if(!this.isAdmin(t))return;if(null===this._setupId)return;var r=e.split(" ");if("/setup-portal"===r[0]){var n=r[1];if(this._setupId!==n)return;var o=this._userPositions.get(t);if(!o)return;var i=o[0],s=o[1];this._target=[i,s],this.saveData({target:[i,s]}),this._setupId=null,this.sendMessage(t,"setuped");}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype.onUnload=function(){try{this._iframeInfo=null,this._target=null;}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
