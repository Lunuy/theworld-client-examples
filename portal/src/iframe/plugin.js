(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var __extends=this&&this.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r;}||function(t,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e]);},t(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r;}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n);}}();var Plugin=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r._iframeInfo=null,r._target=null,r._setupId=null,r._userPositions=new Map,r}return __extends(r,t),r.prototype.onLoad=function(t,r){Logger.init(this);try{if(!r.isLocal)throw new Error("Portal does not support global mode");this._iframeInfo=r.iframe,t?this._target=t.target:this.saveData({target:null});}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},r.prototype.onPlayerMove=function(t,r,e){try{if(null===this._iframeInfo)return;if(this._userPositions.set(t,[r,e]),this._iframeInfo.x<=r&&r<this._iframeInfo.x+this._iframeInfo.width&&this._iframeInfo.y<=e&&e<this._iframeInfo.y+this._iframeInfo.height){if(null===this._target)return;this.teleportPlayer(t,this._target[0],this._target[1]);}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},r.prototype.onMessage=function(t,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];try{if("checkShouldSetup"===r){if(!this.isAdmin(t))return;null===this._target&&(this._setupId=Math.floor(65536*Math.random()).toString(16).padStart(4,"0"),this.sendMessage(t,"setup",this._setupId));}else if("setup"===r){if(!this.isAdmin(t))return;var o=e[0],i=e[1];if(!Number.isInteger(o)||!Number.isInteger(i))return;this._target=[o,i],this.saveData({target:[o,i]});}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},r.prototype.onChat=function(t,r){try{if(!this.isAdmin(t))return;if(null===this._setupId)return;var e=r.split(" ");if("/setup-portal"===e[0]){var n=e[1];if(this._setupId!==n)return;var o=this._userPositions.get(t);if(!o)return;var i=o[0],s=o[1];this._target=[i,s],this.saveData({target:[i,s]}),this.sendMessage(t,"setuped");}}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},r.prototype.onUnload=function(){try{this._iframeInfo=null,this._target=null;}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},r}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
