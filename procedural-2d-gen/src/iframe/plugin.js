(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var Coroutine=function(){function t(t,e){this._elapsedTime=0,this._coroutineIterator=t,this._currentYieldInstruction=null,this._isCurrenYieldInstructionExist=!1,this._onFinish=null!=e?e:null;}return Object.defineProperty(t.prototype,"elapsedTime",{get:function(){return this._elapsedTime},set:function(t){this._elapsedTime=t;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentYieldInstruction",{get:function(){return this._currentYieldInstruction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentYieldInstructionExist",{get:function(){return this._isCurrenYieldInstructionExist},enumerable:!1,configurable:!0}),t.prototype.fatchNextInstruction=function(){var t,e=this._coroutineIterator.next();return e.done?(this._currentYieldInstruction=null,this._isCurrenYieldInstructionExist=!1,null===(t=this._onFinish)||void 0===t||t.call(this),this._onFinish=null,null):(this._currentYieldInstruction=e.value,this._isCurrenYieldInstructionExist=!0,this._currentYieldInstruction)},t}();

	var __extends=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e;}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}}(),YieldInstruction=function(){};var WaitForSeconds=function(t){function e(e){var n=t.call(this)||this;return n._seconds=e,n}return __extends(e,t),Object.defineProperty(e.prototype,"seconds",{get:function(){return this._seconds},enumerable:!1,configurable:!0}),e}(YieldInstruction);var WaitUntil=function(t){function e(e){var n=t.call(this)||this;return n._predicate=e,n}return __extends(e,t),Object.defineProperty(e.prototype,"predicate",{get:function(){return this._predicate},enumerable:!1,configurable:!0}),e}(YieldInstruction);var WaitWhile=function(t){function e(e){var n=t.call(this)||this;return n._predicate=e,n}return __extends(e,t),Object.defineProperty(e.prototype,"predicate",{get:function(){return this._predicate},enumerable:!1,configurable:!0}),e}(YieldInstruction);

	var CoroutineProcessor=function(){function t(t){this._time=t,this._coroutines=[],this._coroutineCount=0;}return t.prototype.addCoroutine=function(t){this._coroutines.push(t),this._coroutineCount+=1;},t.prototype.removeCoroutine=function(t){var o=this._coroutines.indexOf(t);o>=0&&(this._coroutines[o]=null,this._coroutineCount-=1);},t.prototype.tryCompact=function(){var o=this._coroutines;if(t._needToCompactCount<=o.length-this._coroutineCount){for(var n=0,e=0;e<o.length;++e){var i=o[e];null!==i&&(o[n]=i,n+=1);}o.length=this._coroutineCount;}},t.prototype.process=function(){for(var t=this._coroutines,o=0;o<t.length;++o){var n=t[o];null!==n&&(n.currentYieldInstructionExist?this.updateAfterProcessSingleInstruction(n):(t[o]=null,this._coroutineCount-=1));}},t.prototype.updateAfterProcessSingleInstruction=function(t){var o=t.currentYieldInstruction;o instanceof WaitForSeconds?(t.elapsedTime+=this._time.deltaTime,t.elapsedTime>=o.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):o instanceof WaitUntil?o.predicate()&&t.fatchNextInstruction():o instanceof WaitWhile?o.predicate()||t.fatchNextInstruction():null===o&&t.fatchNextInstruction();},t._needToCompactCount=16,t}();

	var Time=function(){function e(){this._oldTime=0,this._time=0,this._unscaledTime=0,this._deltaTime=0,this._unscaledDeltaTime=0,this._timeScale=1;}return e.prototype.start=function(){this._oldTime=Date.now();},e.prototype.update=function(){var e=Date.now(),t=(e-this._oldTime)/1e3;this._unscaledDeltaTime=t,this._unscaledTime+=t,this._deltaTime=t*this._timeScale,this._time+=this._deltaTime,this._oldTime=e;},Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unscaledTime",{get:function(){return this._unscaledTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unscaledDeltaTime",{get:function(){return this._unscaledDeltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale=e;},enumerable:!1,configurable:!0}),e}();

	var CoroutineDispatcher=function(){function o(o){void 0===o&&(o=10);var t=this;this._setTimeoutlId=null,this.update=function(){t._time.update(),t._coroutineProcessor.process(),t._coroutineProcessor.tryCompact();};var e=this._time=new Time;this._coroutineProcessor=new CoroutineProcessor(e),e.start();var r=function(){t._setTimeoutlId=setTimeout((function(){r();}),o);try{t.update();}catch(o){Logger.error("".concat(o.message,"\n").concat(o.stack));}};r();}return o.prototype.startCoroutine=function(o){var t=new Coroutine(o);return t.fatchNextInstruction(),this._coroutineProcessor.addCoroutine(t),t},o.prototype.stopCoroutine=function(o){this._coroutineProcessor.removeCoroutine(o);},o.prototype.dispose=function(){null!==this._setTimeoutlId&&(clearTimeout(this._setTimeoutlId),this._setTimeoutlId=null);},o}();

	var Vector2=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e;}return t.prototype.freeze=function(){return Object.freeze(this)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t}();

	var __extends$1=this&&this.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n;}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n;}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r);}}(),BiomePreset=function(){function t(){}return t.prototype.getTileSprite=function(t){var n=this.tiles;return n[Math.floor(t.next()*n.length)]},t.prototype.matchCondition=function(t,n,e){return t>=this.minHeight&&n>=this.minMoisture&&e>=this.minHeat},t}();var Desert=new(function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.tiles=[{i:70,a:15}],n.minHeight=0,n.minMoisture=0,n.minHeat=.9,n}return __extends$1(n,t),n}(BiomePreset));var Grassland=new(function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.tiles=[{i:70,a:22}],n.minHeight=.1,n.minMoisture=.2,n.minHeat=.1,n}return __extends$1(n,t),n}(BiomePreset));var Mountains=new(function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.tiles=[{i:70,a:54}],n.minHeight=.7,n.minMoisture=0,n.minHeat=0,n}return __extends$1(n,t),n}(BiomePreset));

	var Mulberry32=function(){function t(t){this._a=t;}return t.prototype.next=function(){var t=this._a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},t}();

	var Wave=function(r,e,t){this.seed=r,this.frequency=e,this.amplitude=t;};var NoiseGenerator=function(){function r(){}return r.generate=function(r,e,t,n,o){for(var i=new Array(r),a=0;a<r;a++){i[a]=new Array(e);for(var f=0;f<e;f++)i[a][f]=0;}for(a=0;a<r;++a)for(f=0;f<e;++f){for(var u=a*t+o.x,s=f*t+o.y,h=0,p=0;p<n.length;++p){var l=n[p];i[a][f]+=l.amplitude*(this.perlinNoise(u*l.frequency+l.seed,s*l.frequency+l.seed)+.5),h+=l.amplitude;}i[a][f]/=h;}return i},r.floorToInt=function(r){return r>0?Math.floor(r):Math.ceil(r)},r.fade=function(r){return r*r*r*(r*(6*r-15)+10)},r.grad=function(r,e,t){return (0==(1&r)?e:-e)+(0==(2&r)?t:-t)},r.lerp=function(r,e,t){return e+r*(t-e)},r.perlinNoise=function(e,t){var n=255&r.floorToInt(e),o=255&r.floorToInt(t);e-=Math.floor(e),t-=Math.floor(t);var i=this.fade(e),a=this.fade(t),f=r._perm[n]+o&255,u=r._perm[o+1]+o&255;return this.lerp(a,this.lerp(i,this.grad(r._perm[f],e,t),this.grad(r._perm[u],e-1,t)),this.lerp(i,this.grad(r._perm[f+1],e,t-1),this.grad(r._perm[u+1],e-1,t-1)))},r._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151],r}();

	var BiomeTempData=function(){function e(e){this.biome=e;}return e.prototype.getDiffValue=function(e,t,r){var i=this.biome;return e-i.minHeight+(t-i.minMoisture)+(r-i.minHeat)},e}();var ProceduralMapGenerator=function(){function e(e){this.biomes=[Desert,Grassland,Mountains],this.scale=1,this.heightWaves=[new Wave(56,.05,1),new Wave(199.36,.1,.5)],this.moistureWaves=[new Wave(621,.03,1)],this.heatWaves=[new Wave(318.6,.04,1),new Wave(329.7,.02,.5)],this._mulberry=new Mulberry32(0),this.tilemap=e;}return e.prototype.generateMap=function(e,t,r){for(var i=NoiseGenerator.generate(e,t,this.scale,this.heightWaves,r),a=NoiseGenerator.generate(e,t,this.scale,this.moistureWaves,r),o=NoiseGenerator.generate(e,t,this.scale,this.heatWaves,r),n=0;n<e;n++)for(var s=0;s<t;s++){var h=i[n][s],m=a[n][s],u=o[n][s],l=this.getBiome(h,m,u).getTileSprite(this._mulberry);this.tilemap.setTile(n+r.x,s+r.y,l.i,l.a,!1);}},e.prototype.getBiome=function(e,t,r){for(var i=[],a=this.biomes,o=0;o<a.length;++o){(h=a[o]).matchCondition(e,t,r)&&i.push(new BiomeTempData(h));}var n=0,s=null;for(o=0;o<i.length;++o){var h=i[o];(null==s||h.getDiffValue(e,t,r)<n)&&(s=h.biome,n=h.getDiffValue(e,t,r));}return null==s&&(s=a[0]),s},e}();

	var ChunkLoader=function(){function t(t,e){void 0===e&&(e=15),this._loadedChunks=new Set,this._tempVector2=new Vector2,this.generator=new ProceduralMapGenerator(t),this._chunkSize=e,this._renderer=t;}return t.prototype.vector2ToString=function(t){return t.x+"_"+t.y},t.prototype.generateChunk=function(t){var e=this._chunkSize,o=this._tempVector2.set(t.x*e-Math.floor(e/2),t.y*e-Math.floor(e/2));this.generator.generateMap(e,e,o);},t.prototype.destroyChunk=function(t){for(var e=this._chunkSize,o=this._tempVector2.set(t.x*e-Math.floor(e/2),t.y*e-Math.floor(e/2)),r=this._renderer,n=0;n<e;n++)for(var h=0;h<e;h++)r.deleteTile(o.x+h,o.y+n,!1);},t.prototype.loadChunk=function(t){var e=this.vector2ToString(t);this._loadedChunks.has(e)||(this.generateChunk(t),this._loadedChunks.add(e));},t.prototype.unloadChunk=function(t){var e=this.vector2ToString(t);this._loadedChunks.has(e)&&(this.destroyChunk(t),this._loadedChunks.delete(e));},t.prototype.unloadAllChunks=function(){var t=this;this._loadedChunks.forEach((function(e){var o=e.split("_");t.destroyChunk(new Vector2(parseInt(o[0]),parseInt(o[1])));})),this._loadedChunks.clear();},t.prototype.getChunkIndexFromPosition=function(t,e){return null!=e||(e=new Vector2),e.set(Math.floor((t.x+this._chunkSize/2)/this._chunkSize),Math.floor((t.y+this._chunkSize/2)/this._chunkSize))},t}();

	var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},__assign.apply(this,arguments)},__generator=this&&this.__generator||function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a);}catch(e){i=[6,e],r=0;}finally{n=s=0;}if(5&i[0])throw i[1];return {value:i[0]?i[1]:void 0,done:!0}}([i,o])}}},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return {next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var UserChunkData=function(){this.loadedChunks=new Set,this.loadChunkQueue=new Set,this.unloadChunkQueue=new Set;},WorldGenerator=function(){function e(t,n,r,s,i){void 0===r&&(r=9),void 0===s&&(s=3),void 0===i&&(i=0),this._playerPositions=new Map,this._playerChunkPositions=new Map,this._userChunks=new Map,this._loadedChunks=new Map,this._locked=!1,this._resetParameters=null,this._tempVector2=new Vector2,this._taskQueue=new Set,this._runningTasks=new Set,this._tempVector1=new Vector2,this._coroutineDispatcher=t,this._renderer=n,this._chunkSize=r,this._playerViewDistance=s,this._seed=i,this._chunkLoader=e.createChunkLoader(n,r,i),this._loadCirclePoints=this.computeCirclePoints(this._playerViewDistance),this._unloadChunkQueueMaxValue=3*this._loadCirclePoints.length;}return e.createChunkLoader=function(e,t,n){for(var r=new ChunkLoader(e,t),s=r.generator.heatWaves,i=0;i<s.length;i++)s[i].seed+=n;var a=r.generator.moistureWaves;for(i=0;i<a.length;i++)a[i].seed+=n;var o=r.generator.heightWaves;for(i=0;i<o.length;i++)o[i].seed+=n;return r},e.prototype.computeCirclePoints=function(e){var t=[];if(e<1)return t;if(1==e)return t.push(new Vector2(0,0)),t;var n=0,r=e-=1,s=3-(e+e);do{for(var i=n,a=-n;a<=i;a++)t.push(new Vector2(a,-r)),t.push(new Vector2(a,r));var o=n;for(a=-n;a<=o;a++)t.push(new Vector2(-r,a)),t.push(new Vector2(r,a));n+=1,s+=s<0?6+(n<<2):10+(n-(r-=1)<<2);}while(n<=r);var u=n-1;for(a=-r;a<=r;a++)for(var h=1-n;h<=u;h++)t.push(new Vector2(h,a));var l=new Set;for(a=0;a<t.length;a++){var c=t[a],d="".concat(c.x,",").concat(c.y);l.has(d)?(t.splice(a,1),a--):l.add(d);}return t.sort((function(e,t){var n=e.length(),r=t.length();return n<r?-1:n>r?1:0})),t},e.prototype.updateChunkEnqueue=function(e,t){var n=this._loadCirclePoints,r=this._userChunks.get(e);void 0===r&&(r=new UserChunkData,this._userChunks.set(e,r));var s=r.loadChunkQueue,i=r.unloadChunkQueue;s.clear(),i.clear();var a=[];r.loadedChunks.forEach((function(e){a.push(e);}));for(var o=a.length-1;0<=o;--o)i.add(a[o]);if(t)for(o=0;o<n.length;o++){var u=n[o],h=u.x+t.x+"_"+(u.y+t.y);i.has(h)?i.delete(h):s.add(h);}},e.prototype.processUpdateChunk=function(t){var n,r,s,i,a,o,u,h,l,c,d,_,p,k=this;return __generator(this,(function(f){switch(f.label){case 0:if(n=Date.now(),null===this._resetParameters)return [3,5];f.label=1;case 1:return 0<this._loadedChunks.size?void 0===(r=this._loadedChunks.keys().next().value)?[3,4]:(this._loadedChunks.delete(r),l=r.split("_").map(Number),this._chunkLoader.unloadChunk(this._tempVector2.set(l[0],l[1])),10<(p=Date.now())-n?(n=p,[4,null]):[3,3]):[3,4];case 2:f.sent(),f.label=3;case 3:return [3,1];case 4:return s=this._resetParameters,this._chunkSize=s.chunkSize,this._playerViewDistance=s.playerViewDistance,this._seed=s.seed,this._chunkLoader=e.createChunkLoader(this._renderer,this._chunkSize,this._seed),this._loadCirclePoints=this.computeCirclePoints(this._playerViewDistance),this._unloadChunkQueueMaxValue=3*this._loadCirclePoints.length,this._userChunks.forEach((function(e){e.loadedChunks.clear(),e.loadChunkQueue.clear(),e.unloadChunkQueue.clear();})),this._userChunks.clear(),this._resetParameters=null,this._playerPositions.forEach((function(e,t){k.updatePlayerPosition(t,e,!0);})),[3,9];case 5:if(void 0===(i=void 0!==t?this._userChunks.get(t):void 0))return [2];a=i.loadChunkQueue,o=i.unloadChunkQueue,u=i.loadedChunks,f.label=6;case 6:return !(0<a.size||0<o.size)||this._locked?[3,9]:(this._unloadChunkQueueMaxValue<o.size||a.size<=0?(h=o.keys().next().value,o.delete(h),u.delete(h),void 0!==(d=this._loadedChunks.get(h))&&(d-1<=0?(this._loadedChunks.delete(h),l=h.split("_").map(Number),this._chunkLoader.unloadChunk(this._tempVector2.set(l[0],l[1]))):this._loadedChunks.set(h,d-1))):(c=a.keys().next().value,a.delete(c),u.add(c),void 0===(d=this._loadedChunks.get(c))?(this._loadedChunks.set(c,1),_=c.split("_").map(Number),this._chunkLoader.loadChunk(this._tempVector2.set(_[0],_[1]))):this._loadedChunks.set(c,d+1)),10<(p=Date.now())-n?(n=p,[4,null]):[3,8]);case 7:f.sent(),f.label=8;case 8:return [3,6];case 9:return [2]}}))},e.prototype.lazyUpdateChunk=function(e,t){if(this.updateChunkEnqueue(e,t),!this._runningTasks.has(e)){this._taskQueue.add(e);var n=this;this._runningTasks.size<4&&this._coroutineDispatcher.startCoroutine(function(){return __generator(this,(function(t){switch(t.label){case 0:return n._runningTasks.add(e),[5,__values(n.processUpdateChunk(e))];case 1:return t.sent(),n._runningTasks.delete(e),[2]}}))}());}},e.prototype.lazyResetGenerator=function(e){this._resetParameters=e;var t=this;0===this._runningTasks.size&&this._coroutineDispatcher.startCoroutine(function(){return __generator(this,(function(e){switch(e.label){case 0:return [5,__values(t.processUpdateChunk())];case 1:return e.sent(),[2]}}))}());},e.prototype.updatePlayerPosition=function(e,t,n){void 0===n&&(n=!1);var r=this._chunkLoader,s=this._playerPositions.get(e);void 0!==s?s.copy(t):this._playerPositions.set(e,t.clone());var i=r.getChunkIndexFromPosition(t,this._tempVector1),a=this._playerChunkPositions.get(e);!n&&(null==a?void 0:a.equals(i))||(this.lazyUpdateChunk(e,i),a?a.copy(i):this._playerChunkPositions.set(e,i.clone()));},e.prototype.removePlayer=function(e){this._playerPositions.delete(e),this._playerChunkPositions.get(e)&&(this.lazyUpdateChunk(e,void 0),this._playerChunkPositions.delete(e));},e.prototype.dispose=function(){var e=this;this._loadedChunks.forEach((function(t,n){var r=n.split("_").map(Number);e._chunkLoader.unloadChunk(e._tempVector1.set(r[0],r[1]));})),this._locked=!0;},Object.defineProperty(e.prototype,"chunkSize",{get:function(){return null!==this._resetParameters?this._resetParameters.chunkSize:this._chunkSize},set:function(e){var t=this._resetParameters?__assign(__assign({},this._resetParameters),{chunkSize:e}):{chunkSize:e,seed:this._seed,playerViewDistance:this._playerViewDistance};this.lazyResetGenerator(t);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return null!==this._resetParameters?this._resetParameters.seed:this._seed},set:function(e){var t=this._resetParameters?__assign(__assign({},this._resetParameters),{seed:e}):{chunkSize:this._chunkSize,seed:e,playerViewDistance:this._playerViewDistance};this.lazyResetGenerator(t);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerViewDistance",{get:function(){return null!==this._resetParameters?this._resetParameters.playerViewDistance:this._playerViewDistance},set:function(e){var t=this._resetParameters?__assign(__assign({},this._resetParameters),{playerViewDistance:e}):{chunkSize:this._chunkSize,seed:this._seed,playerViewDistance:e};this.lazyResetGenerator(t);},enumerable:!1,configurable:!0}),e}();

	var __extends$2=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=t;}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o);}}();var Plugin=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._defaultChunkSize=5,t._defaultPlayerViewDistance=5,t._coroutineDispatcher=null,t._worldGenerator=null,t._players=new Set,t._tempVector=new Vector2,t}return __extends$2(t,e),t.prototype.onLoad=function(){Logger.init(this);try{var e=this._coroutineDispatcher=new CoroutineDispatcher;this._worldGenerator=new WorldGenerator(e,this,this._defaultChunkSize,this._defaultPlayerViewDistance);}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onUnload=function(){try{this._coroutineDispatcher.dispose(),this._coroutineDispatcher=null,this._worldGenerator.dispose(),this._worldGenerator=null;}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onPlayerJoin=function(e){var t;try{this._players.add(e),null===(t=this._worldGenerator)||void 0===t||t.updatePlayerPosition(e,this._tempVector.set(0,0));}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onPlayerLeave=function(e){var t;try{this._players.delete(e),null===(t=this._worldGenerator)||void 0===t||t.removePlayer(e);}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onPlayerMove=function(e,t,r){var o;try{null===(o=this._worldGenerator)||void 0===o||o.updatePlayerPosition(e,this._tempVector.set(t,r));}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onMessage=function(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];try{"set-chunk-size"===t?this._worldGenerator&&this.broadcastMessage("chunk-size",this._worldGenerator.chunkSize):"request-chunk-size"===t&&this._worldGenerator&&this.broadcastMessage("chunk-size",this._worldGenerator.chunkSize),"set-player-view-distance"===t?this._worldGenerator&&(this._worldGenerator.playerViewDistance=Math.floor(r[0]),this.broadcastMessage("player-view-distance",this._worldGenerator.playerViewDistance)):"request-player-view-distance"===t&&this._worldGenerator&&this.broadcastMessage("player-view-distance",this._worldGenerator.playerViewDistance),"set-seed"===t?this._worldGenerator&&(this._worldGenerator.seed=r[0],this.broadcastMessage("seed",this._worldGenerator.seed)):"request-seed"===t&&this._worldGenerator&&this.broadcastMessage("seed",this._worldGenerator.seed);}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
