(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var __extends=this&&this.__extends||function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e;}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n);}}();var Plugin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._coroutineDispatcher=null,e._voted_players=new Set,e._vote_count=new Map,e._voting=!1,e._candidates=[],e.data=[],e}return __extends(e,t),e.prototype.onLoad=function(){Logger.init(this);},e.prototype.onUnload=function(){try{this._coroutineDispatcher.dispose(),this._coroutineDispatcher=null;}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype._sendState=function(t){this.sendMessage(t,"pstate",this._voting,this._candidates,this.data,this._voted_players.has(t),this.isAdmin(t));},e.prototype._broadCastState=function(){this.broadcastMessage("state",this._voting,this._candidates,this.data);},e.prototype._updateData=function(){var t=this;this.data=this._candidates.map((function(e,o){return [e,t._vote_count.get(o+1)||0]}));},e.prototype.onPlayerJoin=function(t){this._sendState(t);},e.prototype.onMessage=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];try{switch(e){case"start":this._voting=!0;break;case"stop":this._voting=!1;break;case"reset":this._vote_count.clear(),this._voted_players.clear(),this._candidates=[],this._voting=!1,this._updateData();break;case"vote":if(this._voted_players.has(t))return;this._voted_players.add(t);var a=o[0];if(!Number.isInteger(a)||!this._voting)return;var s=this._vote_count.get(a);this._vote_count.set(a,(s||0)+1),this._updateData();break;case"add_cand":var r=o[0];this._candidates.push(r),this._updateData();break;default:Logger.error("unknown event "+e);}this._broadCastState(),this._sendState(t);}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
