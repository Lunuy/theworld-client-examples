(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var __extends=this&&this.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e;}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}}();var Plugin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._coroutineDispatcher=null,e._voted_players=new Set,e._vote_count=new Map,e._voting=!1,e._candidates=[],e.data=[],e}return __extends(e,t),e.prototype.onLoad=function(){Logger.init(this);},e.prototype.onUnload=function(){try{this._coroutineDispatcher.dispose(),this._coroutineDispatcher=null;}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e.prototype._sendState=function(t){this.sendMessage(t,"pstate",this._voting,this._candidates,this.data,this._voted_players.has(t),this.isAdmin(t));},e.prototype._broadCastState=function(){this.broadcastMessage("state",this._voting,this._candidates,this.data);},e.prototype._updateData=function(){var t=this;this.data=this._candidates.map((function(e,n){return [e,t._vote_count.get(n+1)||0]}));},e.prototype.onMessage=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{switch(e){case"start":if(!this.isAdmin(t))return;this._voting=!0;break;case"stop":if(!this.isAdmin(t))return;this._voting=!1;break;case"reset":if(!this.isAdmin(t))return;var a=[];this._voted_players.forEach((function(t){return a.push(t)})),this._vote_count.clear(),this._voted_players.clear(),this._candidates=[],this._voting=!1,this._updateData();for(var s=0;s<a.length;s++){var o=a[s];try{this._sendState(o);}catch(t){Logger.error(t);}}break;case"vote":if(this._voted_players.has(t))return;this._voted_players.add(t);var i=n[0];if(!Number.isInteger(i)||!this._voting)return;var c=this._vote_count.get(i);this._vote_count.set(i,(c||0)+1),this._updateData();break;case"add_cand":if(!this.isAdmin(t))return;var _=n[0];this._candidates.push(_),this._updateData();break;case"get_state":this._sendState(t);break;default:Logger.error("unknown event "+e);}this._sendState(t),this._broadCastState();}catch(t){Logger.error("".concat(t.message,"\n").concat(t.stack));}},e}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
