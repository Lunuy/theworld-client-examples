(function () {
	'use strict';

	var Logger=function(){function n(){}return n.init=function(o){n._plugin=o;},n.log=function(o){n._plugin.broadcastMessage("log",o);},n.error=function(o){n._plugin.broadcastMessage("error",o);},n}();

	var Direction,__extends=this&&this.__extends||function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=t;}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o);}}();!function(e){e[e.up=0]="up",e[e.right=1]="right",e[e.down=2]="down",e[e.left=3]="left";}(Direction||(Direction={}));var Plugin=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._iframeInfo=null,t._userMoveTimeoutIds=null,t._direction=null,t}return __extends(t,e),t.prototype.onLoad=function(e,t){Logger.init(this);try{if(!t.isLocal)throw new Error("Global not supported");this._iframeInfo=t.iframe,this._userMoveTimeoutIds=new Map,e&&(this._direction=e.direction);}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onMessage=function(e,t){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];try{if("checkShouldSetup"===t)null===this._direction&&this.broadcastMessage("setup");else if("setDirection"===t){var r=i[0];Number.isInteger(r)&&r<=3&&0<=r&&(this._direction=r,this.broadcastMessage("setDirection",this._direction),this.saveData({direction:r}));}else"getDirection"===t&&null!==this._direction&&this.broadcastMessage("setDirection",this._direction);}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onPlayerMove=function(e,t,i){var o=this;try{if(null===this._iframeInfo)return;if(null===this._direction)return;if(null===this._userMoveTimeoutIds)return;if(this._iframeInfo.x<=t&&t<this._iframeInfo.x+this._iframeInfo.width&&this._iframeInfo.y<=i&&i<this._iframeInfo.y+this._iframeInfo.height)this._userMoveTimeoutIds.has(e)&&clearTimeout(this._userMoveTimeoutIds.get(e)),this._userMoveTimeoutIds.set(e,setTimeout((function(){null!==o._iframeInfo&&(o._direction===Direction.up?o.requestMovePlayer(e,t,o._iframeInfo.y+o._iframeInfo.height):o._direction===Direction.right?o.requestMovePlayer(e,o._iframeInfo.x+o._iframeInfo.width,i):o._direction===Direction.down?o.requestMovePlayer(e,t,o._iframeInfo.y-1):o._direction===Direction.left&&o.requestMovePlayer(e,o._iframeInfo.x-1,i));}),200));else{var r=this._userMoveTimeoutIds.get(e);void 0!==r&&(clearTimeout(r),this._userMoveTimeoutIds.delete(e));}}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t.prototype.onPlayerLeave=function(e){if(null!==this._userMoveTimeoutIds){var t=this._userMoveTimeoutIds.get(e);void 0!==t&&(clearTimeout(t),this._userMoveTimeoutIds.delete(e));}},t.prototype.onUnload=function(){try{this._iframeInfo=null,this._direction=null;}catch(e){Logger.error("".concat(e.message,"\n").concat(e.stack));}},t}(BasePlugin);globalThis.PluginImpl=Plugin;

}());
